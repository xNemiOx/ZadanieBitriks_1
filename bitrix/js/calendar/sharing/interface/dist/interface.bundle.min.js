this.BX=this.BX||{};this.BX.Calendar=this.BX.Calendar||{};(function(e,t,s,i,a,r,o,n,l,h,d,c){"use strict";let p=e=>e,g,u;var _=babelHelpers.classPrivateFieldLooseKey("popup");var T=babelHelpers.classPrivateFieldLooseKey("loader");var b=babelHelpers.classPrivateFieldLooseKey("layout");var E=babelHelpers.classPrivateFieldLooseKey("qrCode");var P=babelHelpers.classPrivateFieldLooseKey("context");class N{constructor(e){this.QRCODE_SIZE=114;this.QRCODE_COLOR_LIGHT="#fff";this.QRCODE_COLOR_DARK="#000";Object.defineProperty(this,_,{writable:true,value:void 0});Object.defineProperty(this,T,{writable:true,value:void 0});Object.defineProperty(this,b,{writable:true,value:void 0});Object.defineProperty(this,E,{writable:true,value:void 0});Object.defineProperty(this,P,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_)[_]=null;babelHelpers.classPrivateFieldLooseBase(this,T)[T]=null;babelHelpers.classPrivateFieldLooseBase(this,b)[b]={qr:null};babelHelpers.classPrivateFieldLooseBase(this,E)[E]=null;babelHelpers.classPrivateFieldLooseBase(this,P)[P]=e.context;this.sharingUrl=e.sharingUrl}getPopup(){if(!babelHelpers.classPrivateFieldLooseBase(this,_)[_]){babelHelpers.classPrivateFieldLooseBase(this,_)[_]=new i.Popup({className:"calendar-sharing__qr",width:315,padding:0,content:this.getContent(),closeIcon:true,closeByEsc:true,autoHide:true,overlay:true,animation:"fading-slide"})}return babelHelpers.classPrivateFieldLooseBase(this,_)[_]}getLoader(){if(!babelHelpers.classPrivateFieldLooseBase(this,T)[T]){babelHelpers.classPrivateFieldLooseBase(this,T)[T]=new a.Loader({size:95})}return babelHelpers.classPrivateFieldLooseBase(this,T)[T]}getNodeQr(){if(!babelHelpers.classPrivateFieldLooseBase(this,b)[b].qr){babelHelpers.classPrivateFieldLooseBase(this,b)[b].qr=s.Tag.render(g||(g=p`
				<div class="calendar-sharing__qr-block"></div>
			`));this.getLoader().show(babelHelpers.classPrivateFieldLooseBase(this,b)[b].qr);this.showQr()}return babelHelpers.classPrivateFieldLooseBase(this,b)[b].qr}async showQr(){await this.initQrCode();this.QRCode=new QRCode(babelHelpers.classPrivateFieldLooseBase(this,b)[b].qr,{text:this.sharingUrl,width:this.QRCODE_SIZE,height:this.QRCODE_SIZE,colorDark:this.QRCODE_COLOR_DARK,colorLight:this.QRCODE_COLOR_LIGHT,correctLevel:QRCode.CorrectLevel.H});await this.getLoader().hide()}async initQrCode(){await s.Runtime.loadExtension(["main.qrcode"])}getContent(){return s.Tag.render(u||(u=p`
			<div class="calendar-sharing__qr-content">
				<div class="calendar-sharing__qr-title">${0}</div>
				${0}
				<div class="calendar-sharing__qr-info">${0}</div>
				<a class="calendar-sharing__dialog-link" href="${0}" target="_blank">${0}</a>
			</div>
		`),this.getPhraseDependsOnContext("SHARING_INFO_POPUP_QR_TITLE"),this.getNodeQr(),s.Loc.getMessage("SHARING_INFO_POPUP_QR_INFO"),this.sharingUrl,s.Loc.getMessage("SHARING_INFO_POPUP_QR_OPEN_LINK"))}isShown(){return this.getPopup().isShown()}close(){this.getPopup().close()}show(){this.getPopup().show()}destroy(){this.getPopup().destroy()}getPhraseDependsOnContext(e){return s.Loc.getMessage(e+"_"+babelHelpers.classPrivateFieldLooseBase(this,P)[P].toUpperCase())}}let v=e=>e,w,L,A,O;var B=babelHelpers.classPrivateFieldLooseKey("popup");var C=babelHelpers.classPrivateFieldLooseKey("layout");var I=babelHelpers.classPrivateFieldLooseKey("dialogQr");var F=babelHelpers.classPrivateFieldLooseKey("context");class S{constructor(e){this.HELP_DESK_CODE_CALENDAR=17198666;this.HELP_DESK_CODE_CRM=17502612;Object.defineProperty(this,B,{writable:true,value:void 0});Object.defineProperty(this,C,{writable:true,value:void 0});Object.defineProperty(this,I,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,B)[B]=null;babelHelpers.classPrivateFieldLooseBase(this,I)[I]=null;babelHelpers.classPrivateFieldLooseBase(this,C)[C]={wrapper:null,contentTop:null,contentBody:null,contentBottom:null,buttonCopy:null};babelHelpers.classPrivateFieldLooseBase(this,F)[F]=e.context;this.bindElement=e.bindElement||null;this.sharingUrl=e.sharingUrl||null}getPopup(){if(!babelHelpers.classPrivateFieldLooseBase(this,B)[B]){babelHelpers.classPrivateFieldLooseBase(this,B)[B]=new i.Popup({bindElement:this.bindElement,className:"calendar-sharing__dialog",closeByEsc:true,autoHide:true,padding:0,width:470,angle:{offset:this.bindElement.offsetWidth/2+16},autoHideHandler:e=>this.autoHideHandler(e),content:this.getPopupWrapper(),animation:"fading-slide",events:{onPopupShow:()=>this.bindElement.classList.add("ui-btn-hover"),onPopupClose:()=>this.bindElement.classList.remove("ui-btn-hover")}})}return babelHelpers.classPrivateFieldLooseBase(this,B)[B]}autoHideHandler(e){var t;return!babelHelpers.classPrivateFieldLooseBase(this,C)[C].wrapper.contains(e.target)&&!((t=babelHelpers.classPrivateFieldLooseBase(this,I)[I])!=null&&t.isShown())}getDialogQr(){if(!babelHelpers.classPrivateFieldLooseBase(this,I)[I]){babelHelpers.classPrivateFieldLooseBase(this,I)[I]=new N({sharingUrl:this.sharingUrl,context:babelHelpers.classPrivateFieldLooseBase(this,F)[F]})}return babelHelpers.classPrivateFieldLooseBase(this,I)[I]}getPopupWrapper(){if(!babelHelpers.classPrivateFieldLooseBase(this,C)[C].wrapper){babelHelpers.classPrivateFieldLooseBase(this,C)[C].wrapper=s.Tag.render(w||(w=v`
				<div class="calendar-sharing__dialog-wrapper">
					${0}
					<div class="calendar-sharing__dialog-body">
						<div class="calendar-sharing__dialog-userpic"></div>
						<div class="calendar-sharing__dialog-notify">
							<div class="calendar-sharing__dialog-notify_content">
								${0}
							</div>
						</div>
					</div>
					${0}
				</div>
			`),this.getPopupContentTop(),s.Loc.getMessage("SHARING_INFO_POPUP_CONTENT_4",{"#LINK#":this.sharingUrl}),this.getPopupContentBottom())}return babelHelpers.classPrivateFieldLooseBase(this,C)[C].wrapper}getPopupCopyLinkButton(){if(!babelHelpers.classPrivateFieldLooseBase(this,C)[C].buttonCopy){babelHelpers.classPrivateFieldLooseBase(this,C)[C].buttonCopy=s.Tag.render(L||(L=v`
				<span onclick="${0}" class="ui-btn ui-btn-success ui-btn-round ui-btn-no-caps">${0}</span>
			`),this.adjustSave.bind(this),s.Loc.getMessage("SHARING_DIALOG_SHARING_BLOCK_COPY_LINK_BUTTON"))}return babelHelpers.classPrivateFieldLooseBase(this,C)[C].buttonCopy}adjustSave(){if(this.copyLink()){this.onSuccessfulCopyingLink()}}copyLink(){let e=false;if(this.sharingUrl){e=BX.clipboard.copy(this.sharingUrl)}if(e){n.Util.showNotification(s.Loc.getMessage("SHARING_COPY_LINK_NOTIFICATION"));t.EventEmitter.emit("CalendarSharing:LinkCopied")}return e}onSuccessfulCopyingLink(){this.getPopup().close()}getPopupContentBottom(){if(!babelHelpers.classPrivateFieldLooseBase(this,C)[C].contentBottom){const e=()=>{this.getDialogQr().show()};babelHelpers.classPrivateFieldLooseBase(this,C)[C].contentBottom=s.Tag.render(A||(A=v`
				<div class="calendar-sharing__dialog-bottom">
					${0}
					<span onclick="${0}" class="calendar-sharing__dialog-link">${0}</span>
				</div>
			`),this.getPopupCopyLinkButton(),e,s.Loc.getMessage("SHARING_INFO_POPUP_WHAT_SEE_USERS"))}return babelHelpers.classPrivateFieldLooseBase(this,C)[C].contentBottom}getPopupContentTop(){if(!babelHelpers.classPrivateFieldLooseBase(this,C)[C].contentTop){const e=()=>{top.BX.Helper.show("redirect=detail&code="+this.getHelpDeskCodeDependsOnContext())};babelHelpers.classPrivateFieldLooseBase(this,C)[C].contentTop=s.Tag.render(O||(O=v`
				<div class="calendar-sharing__dialog-top">
					<div class="calendar-sharing__dialog-title">
						<span>${0}</span>
						<span onclick="${0}" class="calendar-sharing__dialog-title-help"  title="${0}"></span>
					</div>
					<div class="calendar-sharing__dialog-info">${0}</div>
				</div>
			`),s.Loc.getMessage("SHARING_BUTTON_TITLE"),e,s.Loc.getMessage("SHARING_INFO_POPUP_HOW_IT_WORK"),this.getPhraseDependsOnContext("SHARING_INFO_POPUP_CONTENT_3")+" ");const t=babelHelpers.classPrivateFieldLooseBase(this,C)[C].contentTop.querySelector('[ data-role="calendar-sharing_popup-open-link"]');if(t){let e;let a;t.addEventListener("mouseenter",(()=>{a=setTimeout((()=>{if(!e){e=new i.Popup({bindElement:t,angle:{offset:t.offsetWidth/2+16},width:410,darkMode:true,content:s.Loc.getMessage("SHARING_INFO_POPUP_SLOT_DESC"),animation:"fading-slide"})}e.show()}),1e3)}));t.addEventListener("mouseleave",(()=>{clearTimeout(a);if(e){e.close()}}))}}return babelHelpers.classPrivateFieldLooseBase(this,C)[C].contentTop}isShown(){return this.getPopup().isShown()}show(){if(!this.bindElement){console.warn('BX.Calendar.Sharing: "bindElement" is not defined');return}this.getPopup().show()}destroy(){this.getPopup().destroy();this.getDialogQr().destroy()}getPhraseDependsOnContext(e){return s.Loc.getMessage(e+"_"+babelHelpers.classPrivateFieldLooseBase(this,F)[F].toUpperCase())}getHelpDeskCodeDependsOnContext(){let e=0;switch(babelHelpers.classPrivateFieldLooseBase(this,F)[F]){case"calendar":{e=this.HELP_DESK_CODE_CALENDAR;break}case"crm":{e=this.HELP_DESK_CODE_CRM;break}}return e}}let H=e=>e,R,U,f;class D{constructor(e={}){var t;this.PAY_ATTENTION_TO_NEW_FEATURE_DELAY=1e3;this.PAY_ATTENTION_TO_NEW_FEATURE_FIRST="first-feature";this.PAY_ATTENTION_TO_NEW_FEATURE_NEW="new-feature";this.PAY_ATTENTION_TO_NEW_FEATURE_REMIND="remind-feature";this.PAY_ATTENTION_TO_NEW_FEATURE_WITHOUT_TEXT_MODS=[this.PAY_ATTENTION_TO_NEW_FEATURE_FIRST];this.PAY_ATTENTION_TO_NEW_FEATURE_WITH_TEXT_MODS=[this.PAY_ATTENTION_TO_NEW_FEATURE_NEW,this.PAY_ATTENTION_TO_NEW_FEATURE_REMIND];this.AVAILABLE_PAY_ATTENTION_TO_NEW_FEATURE_MODS=[...this.PAY_ATTENTION_TO_NEW_FEATURE_WITHOUT_TEXT_MODS,...this.PAY_ATTENTION_TO_NEW_FEATURE_WITH_TEXT_MODS];this.wrap=e.wrap;this.userId=e.userId;this.sharingConfig=n.Util.getSharingConfig();this.sharingUrl=((t=this.sharingConfig)==null?void 0:t.url)||null;this.payAttentionToNewFeatureMode=e.payAttentionToNewFeature}show(){s.Dom.addClass(this.wrap,"calendar-sharing__btn-wrap");this.button=new BX.UI.Button({text:s.Loc.getMessage("SHARING_BUTTON_TITLE"),round:true,size:BX.UI.Button.Size.EXTRA_SMALL,color:BX.UI.Button.Color.LIGHT_BORDER,className:"ui-btn-themes calendar-sharing__btn",onclick:(e,t)=>{if(!this.switcher.getNode().contains(t.target)){this.handleSharingButtonClick()}}});this.button.renderTo(this.wrap);this.renderSwitcher();if(this.AVAILABLE_PAY_ATTENTION_TO_NEW_FEATURE_MODS.includes(this.payAttentionToNewFeatureMode)){this.payAttentionToNewFeature(this.payAttentionToNewFeatureMode);BX.ajax.runAction("calendar.api.sharingajax.disableOptionPayAttentionToNewSharingFeature")}}handleSharingButtonClick(){if(!this.isSharingEnabled()){this.switcher.toggle()}else{this.openDialog()}}getSwitcherContainer(){const e=s.Tag.render(R||(R=H`
			<div class="calendar-sharing__switcher">
				
			</div>
		`));return e}getSwitcherDivider(){const e=s.Tag.render(U||(U=H`
			<div class="calendar-sharing__switcher_divider"></div>
		`));return e}renderSwitcher(){s.Dom.append(this.getSwitcherDivider(),this.wrap);this.switcherWrap=s.Tag.render(f||(f=H`<div class="calendar-sharing__switcher-wrap"></div>`));s.Dom.append(this.switcherWrap,this.wrap);s.Event.bind(this.switcherWrap,"click",this.handleSwitcherWrapClick.bind(this),{capture:true});this.switcher=new BX.UI.Switcher({node:this.getSwitcherContainer(),checked:this.isSharingEnabled(),color:"green",size:"small",handlers:{toggled:()=>this.handleSwitcherToggled()}});this.switcher.renderTo(this.switcherWrap)}handleSwitcherWrapClick(e){if(this.switcher.isChecked()){this.showWarningPopup();e.stopPropagation()}}handleSwitcherToggled(){if(this.isToggledAfterErrorOccurred()){return}if(this.switcher.isChecked()){this.enableSharing()}else{this.disableSharing()}}isToggledAfterErrorOccurred(){return this.switcher.isChecked()===this.isSharingEnabled()}isSharingEnabled(){return s.Type.isString(this.sharingUrl)}enableSharing(){const e="calendar.api.sharingajax.enableUserSharing";const s="Calendar.Sharing.copyLinkButton:onSharingEnabled";BX.ajax.runAction(e).then((e=>{this.sharingUrl=e.data.url;this.openDialog();t.EventEmitter.emit(s,{isChecked:this.switcher.isChecked(),url:e.data.url})})).catch((()=>{this.switcher.toggle()}))}openDialog(){var e;(e=this.pulsar)==null?void 0:e.close();s.Dom.remove(this.counterNode);if(!this.newDialog){this.newDialog=new S({bindElement:this.button.getContainer(),sharingUrl:this.sharingUrl,context:"calendar"})}if(!this.newDialog.isShown()){this.newDialog.show();this.newDialog.copyLink()}}disableSharing(){const e="calendar.api.sharingajax.disableUserSharing";const s="Calendar.Sharing.copyLinkButton:onSharingDisabled";this.warningPopup.close();BX.ajax.runAction(e).then((()=>{this.sharingUrl=null;if(this.newDialog){this.newDialog.destroy();this.newDialog=null}t.EventEmitter.emit(s,{isChecked:this.switcher.isChecked()})})).catch((()=>{this.switcher.toggle()}))}showWarningPopup(){if(!this.warningPopup){this.warningPopup=new BX.UI.Dialogs.MessageBox({title:s.Loc.getMessage("SHARING_WARNING_POPUP_TITLE"),message:s.Loc.getMessage("SHARING_WARNING_POPUP_CONTENT"),buttons:this.getWarningPopupButtons(),popupOptions:{autoHide:true,closeByEsc:true,draggable:true,closeIcon:true,minWidth:365,maxWidth:365}})}this.warningPopup.show()}getWarningPopupButtons(){return[this.getSubmitButton(),this.getCancelButton()]}getSubmitButton(){return new BX.UI.Button({size:BX.UI.Button.Size.MEDIUM,color:BX.UI.Button.Color.DANGER,text:s.Loc.getMessage("SHARING_WARNING_POPUP_SUBMIT_BUTTON"),events:{click:()=>this.handleSubmitButtonClick()}})}getCancelButton(){return new BX.UI.Button({size:BX.UI.Button.Size.MEDIUM,color:BX.UI.Button.Color.LIGHT_BORDER,text:s.Loc.getMessage("SHARING_WARNING_POPUP_CANCEL_BUTTON"),events:{click:()=>this.handleCancelButtonClick()}})}handleSubmitButtonClick(){this.switcher.toggle();this.warningPopup.close()}handleCancelButtonClick(){this.warningPopup.close()}payAttentionToNewFeature(e){if(this.PAY_ATTENTION_TO_NEW_FEATURE_WITHOUT_TEXT_MODS.includes(e)){this.payAttentionToNewFeatureWithoutText()}if(this.PAY_ATTENTION_TO_NEW_FEATURE_WITH_TEXT_MODS.includes(e)){this.payAttentionToNewFeatureWithText(e)}}payAttentionToNewFeatureWithoutText(){this.pulsar=this.getPulsar(this.wrap,false);this.pulsar.show();s.Event.bind(this.pulsar.container,"click",(()=>{this.handleSharingButtonClick()}));this.counterNode=new c.Counter({value:1,color:c.Counter.Color.DANGER,size:c.Counter.Size.MEDIUM,animation:false}).getContainer();s.Dom.addClass(this.counterNode,"calendar-sharing__new-feature-counter");s.Dom.append(this.counterNode,this.wrap)}payAttentionToNewFeatureWithText(e){let t=s.Loc.getMessage("CALENDAR_PAY_ATTENTION_TO_NEW_FEATURE_TITLE");let i=s.Loc.getMessage("CALENDAR_PAY_ATTENTION_TO_NEW_FEATURE_TEXT");if(e===this.PAY_ATTENTION_TO_NEW_FEATURE_REMIND){t=s.Loc.getMessage("CALENDAR_PAY_ATTENTION_TO_NEW_FEATURE_NOTIFY_TITLE");i=s.Loc.getMessage("CALENDAR_PAY_ATTENTION_TO_NEW_FEATURE_NOTIFY_TEXT")}const a=this.getGuide(t,i);const r=this.getPulsar(this.wrap);setTimeout((()=>{a.showNextStep();a.getPopup().setAngle({offset:210});r.show()}),this.PAY_ATTENTION_TO_NEW_FEATURE_DELAY)}getGuide(e,t){const i=new d.Guide({simpleMode:true,onEvents:true,steps:[{target:this.wrap,title:e,text:t,position:"bottom",condition:{top:true,bottom:false,color:"primary"}}]});const a=i.getPopup();s.Dom.addClass(a.popupContainer,"calendar-popup-ui-tour-animate");a.setWidth(400);a.getContentContainer().style.paddingRight=getComputedStyle(a.closeIcon)["width"];return i}getPulsar(e,t=true){const s=new BX.SpotLight({targetElement:e,targetVertex:"middle-center",lightMode:true});if(t){s.bindEvents({onTargetEnter:()=>s.close()})}return s}}class y{constructor(e){var t;this.buttonWrap=e.buttonWrap;this.userId=e.userId;this.payAttentionToNewFeature=(t=e.payAttentionToNewFeature)!=null?t:false}showSharingButton(){this.sharingButton=new D({wrap:this.buttonWrap,userId:this.userId,payAttentionToNewFeature:this.payAttentionToNewFeature});this.sharingButton.show()}}e.Interface=y;e.SharingButton=D;e.DialogNew=S;e.DialogQr=N})(this.BX.Calendar.Sharing=this.BX.Calendar.Sharing||{},BX.Event,BX,BX.Main,BX,BX,BX,BX.Calendar,BX,BX,BX.UI.Tour,BX.UI);
//# sourceMappingURL=interface.bundle.map.js